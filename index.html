<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESP8266 Sensor Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-gauges/gauge.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    h2 { margin: 20px; }
    .gauge-container { display: inline-block; margin: 20px; }
  </style>
</head>
<body>
  <h2>ESP8266 Sensor Dashboard</h2>

  <div class="gauge-container">
    <canvas id="gaugeTemp" data-type="radial-gauge"
      data-title="Temperature"
      data-min-value="0" data-max-value="100"
      data-units="°C"
      data-major-ticks="0,10,20,30,40,50,60,70,80,90,100"
      data-highlights='[{"from":50,"to":100,"color":"rgba(200,50,50,.75)"}]'
      data-value="0"
      data-width="250"
      data-height="250">
    </canvas>
  </div>

  <div class="gauge-container">
    <canvas id="gaugeHum" data-type="radial-gauge"
      data-title="Humidity"
      data-min-value="0" data-max-value="100"
      data-units="%"
      data-major-ticks="0,20,40,60,80,100"
      data-highlights='[{"from":80,"to":100,"color":"rgba(50,50,200,.75)"}]'
      data-value="0"
      data-width="250"
      data-height="250">
    </canvas>
  </div>

  <div class="gauge-container">
    <canvas id="gaugeVolt" data-type="radial-gauge"
      data-title="Voltage"
      data-min-value="0" data-max-value="10"
      data-units="V"
      data-major-ticks="0,2,4,6,8,10"
      data-highlights='[{"from":7,"to":10,"color":"rgba(255,165,0,.75)"}]'
      data-value="0"
      data-width="250"
      data-height="250">
    </canvas>
  </div>

  <script>
    const TOKEN = "djlxGXmIjuPjubwUqdVCMgB76av9UhNI"; // Token của bạn

    async function fetchValue(pin) {
      let url = `https://blynk.cloud/external/api/get?token=${TOKEN}&${pin}`;
      try {
        let res = await fetch(url);
        let text = await res.text();
        console.log(`Pin ${pin}:`, text);
        return parseFloat(text);
      } catch (e) {
        console.error("Lỗi fetch:", e);
        return 0;
      }
    }

    async function updateGauges() {
      let temp = await fetchValue("v1");
      let hum = await fetchValue("v2");
      let volt = await fetchValue("v3");

      if (!isNaN(temp)) document.gaugeTemp.value = temp;
      if (!isNaN(hum)) document.gaugeHum.value = hum;
      if (!isNaN(volt)) document.gaugeVolt.value = volt;
    }

    setInterval(updateGauges, 5000);
    updateGauges();
  </script>
</body>
</html>
