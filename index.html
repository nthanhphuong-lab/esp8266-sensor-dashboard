<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Blynk ESP8266 Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-gauges@2.1.7/gauge.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f4f4f4;
      margin: 20px;
    }
    h2 { margin-bottom: 30px; }
    .gauges {
      display: flex;
      justify-content: center;
      gap: 50px;
      flex-wrap: wrap;
    }
    .gauge-box {
      width: 280px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .value {
      font-size: 32px;
      font-weight: bold;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h2>üì° D·ªØ li·ªáu t·ª´ ESP8266 qua Blynk</h2>

  <div class="gauges">
    <div class="gauge-box">
      <canvas id="gaugeTemp" data-type="linear-gauge"
        data-units="¬∞C" data-title="Nhi·ªát ƒë·ªô"
        data-min-value="0" data-max-value="60"
        data-major-ticks="0,10,20,30,40,50,60"
        data-minor-ticks="2"
        data-color-plate="#fff"
        data-bar-color="#ff5722"
        data-border-shadow-width="0"
        data-borders="false"
        data-value="0">
      </canvas>
      <div class="value" id="valTemp">0 ¬∞C</div>
    </div>

    <div class="gauge-box">
      <canvas id="gaugeHumi" data-type="linear-gauge"
        data-units="%" data-title="ƒê·ªô ·∫©m"
        data-min-value="0" data-max-value="100"
        data-major-ticks="0,20,40,60,80,100"
        data-minor-ticks="4"
        data-color-plate="#fff"
        data-bar-color="#2196f3"
        data-border-shadow-width="0"
        data-borders="false"
        data-value="0">
      </canvas>
      <div class="value" id="valHumi">0 %</div>
    </div>

    <div class="gauge-box">
      <canvas id="gaugeVolt" data-type="linear-gauge"
        data-units="V" data-title="ƒêi·ªán √°p"
        data-min-value="0" data-max-value="20"
        data-major-ticks="0,5,10,15,20"
        data-minor-ticks="1"
        data-color-plate="#fff"
        data-bar-color="#4caf50"
        data-border-shadow-width="0"
        data-borders="false"
        data-value="0">
      </canvas>
      <div class="value" id="valVolt">0 V</div>
    </div>
  </div>

  <script>
    const token = "djlxGXmIjuPjubwUqdVCMgB76av9UhNI";

    async function getData() {
      try {
        const temp = await fetch(`https://blynk.cloud/external/api/get?token=${token}&v1`).then(r=>r.text());
        const humi = await fetch(`https://blynk.cloud/external/api/get?token=${token}&v2`).then(r=>r.text());
        const volt = await fetch(`https://blynk.cloud/external/api/get?token=${token}&v3`).then(r=>r.text());

        document.gauges.forEach(g => {
          if (g.canvas.element.id === "gaugeTemp") g.value = parseFloat(temp) || 0;
          if (g.canvas.element.id === "gaugeHumi") g.value = parseFloat(humi) || 0;
          if (g.canvas.element.id === "gaugeVolt") g.value = parseFloat(volt) || 0;
        });

        // update text
        document.getElementById("valTemp").innerText = (parseFloat(temp)||0) + " ¬∞C";
        document.getElementById("valHumi").innerText = (parseFloat(humi)||0) + " %";
        document.getElementById("valVolt").innerText = (parseFloat(volt)||0) + " V";

      } catch (e) {
        console.error("L·ªói khi g·ªçi API Blynk:", e);
      }
    }

    getData();
    setInterval(getData, 5000);
  </script>
</body>
</html>
