<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ESP8266 Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-gauges/gauge.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      margin: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 30px;
    }
    .gauges {
      display: flex;
      justify-content: space-around;
      margin-bottom: 40px;
    }
    .card {
      text-align: center;
    }
    canvas {
      max-width: 100%;
    }
    .charts {
      display: flex;
      justify-content: space-around;
    }
    .chart-box {
      width: 48%;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h2>ğŸ“¡ ESP8266 Sensor Dashboard</h2>

  <!-- HÃ ng trÃªn: Gauge -->
  <div class="gauges">
    <div class="card">
      <h3>Nhiá»‡t Ä‘á»™</h3>
      <canvas id="gaugeTemp"></canvas>
    </div>
    <div class="card">
      <h3>Äá»™ áº©m</h3>
      <canvas id="gaugeHumi"></canvas>
    </div>
    <div class="card">
      <h3>Äiá»‡n Ã¡p</h3>
      <canvas id="gaugeVolt"></canvas>
    </div>
  </div>

  <!-- HÃ ng dÆ°á»›i: Biá»ƒu Ä‘á»“ -->
  <div class="charts">
    <div class="chart-box">
      <h3>Nhiá»‡t Ä‘á»™ theo thá»i gian</h3>
      <canvas id="chartTemp"></canvas>
    </div>
    <div class="chart-box">
      <h3>Äiá»‡n Ã¡p theo thá»i gian</h3>
      <canvas id="chartVolt"></canvas>
    </div>
  </div>

  <script>
    // HÃ m táº¡o gauge
    function createGauge(elementId, min, max, unit, color) {
      return new RadialGauge({
        renderTo: elementId,
        width: 250,
        height: 250,
        units: unit,
        minValue: min,
        maxValue: max,
        majorTicks: [min, (max/2), max],
        minorTicks: 2,
        strokeTicks: true,
        highlights: [{ from: min, to: max, color: color }],
        colorPlate: "#fff",
        colorNumbers: "#000",
        valueBox: true,
        animation: true,
        animationDuration: 500,
        animationRule: "linear",
        needle: true,
        needleCircleSize: 8,
        borders: false,
        value: 0
      }).draw();
    }

    // Táº¡o 3 gauge
    const gaugeTemp = createGauge("gaugeTemp", 0, 100, "Â°C", "rgba(103,58,183,0.3)");
    const gaugeHumi = createGauge("gaugeHumi", 0, 100, "%", "rgba(0,150,136,0.3)");
    const gaugeVolt = createGauge("gaugeVolt", 0, 30, "V", "rgba(233,30,99,0.3)");

    // Chart config
    const ctxTemp = document.getElementById('chartTemp').getContext('2d');
    const ctxVolt = document.getElementById('chartVolt').getContext('2d');

    const chartTemp = new Chart(ctxTemp, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Nhiá»‡t Ä‘á»™ (Â°C)',
          borderColor: 'rgba(103,58,183,1)',
          backgroundColor: 'rgba(103,58,183,0.2)',
          data: [],
          fill: true,
          tension: 0.3
        }]
      },
      options: { responsive: true }
    });

    const chartVolt = new Chart(ctxVolt, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Äiá»‡n Ã¡p (V)',
          borderColor: 'rgba(233,30,99,1)',
          backgroundColor: 'rgba(233,30,99,0.2)',
          data: [],
          fill: true,
          tension: 0.3
        }]
      },
      options: { responsive: true }
    });

    // Cáº­p nháº­t dá»¯ liá»‡u random má»—i 5 giÃ¢y
    setInterval(() => {
      const now = new Date().toLocaleTimeString();
      const temp = (20 + Math.random()*10).toFixed(1);
      const humi = (40 + Math.random()*30).toFixed(1);
      const volt = (12 + Math.random()*3).toFixed(2);

      // Update gauge
      gaugeTemp.value = temp;
      gaugeHumi.value = humi;
      gaugeVolt.value = volt;

      // Update chart nhiá»‡t Ä‘á»™
      chartTemp.data.labels.push(now);
      chartTemp.data.datasets[0].data.push(temp);
      if(chartTemp.data.labels.length > 20) {
        chartTemp.data.labels.shift();
        chartTemp.data.datasets[0].data.shift();
      }
      chartTemp.update();

      // Update chart Ä‘iá»‡n Ã¡p
      chartVolt.data.labels.push(now);
      chartVolt.data.datasets[0].data.push(volt);
      if(chartVolt.data.labels.length > 20) {
        chartVolt.data.labels.shift();
        chartVolt.data.datasets[0].data.shift();
      }
      chartVolt.update();

    }, 5000);
  </script>
</body>
</html>
