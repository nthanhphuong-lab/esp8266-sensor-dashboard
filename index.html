<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESP8266 Gauge Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-gauges/gauge.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f5f5f5;
    }
    h2 { margin-top: 20px; }
    .gauge-container {
      display: inline-block;
      margin: 20px;
    }
  </style>
</head>
<body>
  <h2>ESP8266 Sensor Gauges</h2>

  <div class="gauge-container">
    <canvas id="gauge-temp" width="200" height="200"></canvas>
    <p>Temperature (°C)</p>
  </div>

  <div class="gauge-container">
    <canvas id="gauge-hum" width="200" height="200"></canvas>
    <p>Humidity (%)</p>
  </div>

  <div class="gauge-container">
    <canvas id="gauge-volt" width="200" height="200"></canvas>
    <p>Voltage (V)</p>
  </div>

  <script>
    const token = "YOUR_BLYNK_AUTH_TOKEN"; // thay bằng token của bạn
    const apiUrl = "https://blynk.cloud/external/api/get?token=" + token;

    // Gauge Temperature
    const gTemp = new RadialGauge({
      renderTo: 'gauge-temp',
      width: 200,
      height: 200,
      units: "°C",
      minValue: 0,
      maxValue: 50,
      majorTicks: ["0","10","20","30","40","50"],
      minorTicks: 2,
      strokeTicks: true,
      highlights: [
        { from: 0, to: 35, color: 'rgba(0,200,0,.3)' },
        { from: 35, to: 50, color: 'rgba(200,0,0,.3)' }
      ],
      colorPlate: "#fff",
      borders: true,
      needleType: "arrow",
      needleWidth: 2,
      animationDuration: 500,
      animationRule: "linear"
    }).draw();

    // Gauge Humidity
    const gHum = new RadialGauge({
      renderTo: 'gauge-hum',
      width: 200,
      height: 200,
      units: "%",
      minValue: 0,
      maxValue: 100,
      majorTicks: ["0","20","40","60","80","100"],
      minorTicks: 2,
      strokeTicks: true,
      highlights: [
        { from: 0, to: 60, color: 'rgba(0,200,255,.3)' },
        { from: 60, to: 100, color: 'rgba(0,0,200,.3)' }
      ],
      colorPlate: "#fff",
      borders: true,
      needleType: "arrow",
      needleWidth: 2,
      animationDuration: 500,
      animationRule: "linear"
    }).draw();

    // Gauge Voltage
    const gVolt = new RadialGauge({
      renderTo: 'gauge-volt',
      width: 200,
      height: 200,
      units: "V",
      minValue: 0,
      maxValue: 5,
      majorTicks: ["0","1","2","3","4","5"],
      minorTicks: 2,
      strokeTicks: true,
      highlights: [
        { from: 0, to: 4, color: 'rgba(0,200,0,.3)' },
        { from: 4, to: 5, color: 'rgba(200,0,0,.3)' }
      ],
      colorPlate: "#fff",
      borders: true,
      needleType: "arrow",
      needleWidth: 2,
      animationDuration: 500,
      animationRule: "linear"
    }).draw();

    // Hàm cập nhật dữ liệu từ Blynk
    function updateGauges() {
      Promise.all([
        fetch(apiUrl + "&V1").then(r => r.text()),
        fetch(apiUrl + "&V2").then(r => r.text()),
        fetch(apiUrl + "&V3").then(r => r.text())
      ]).then(values => {
        let [temp, hum, volt] = values.map(parseFloat);

        if (!isNaN(temp)) gTemp.value = temp;
        if (!isNaN(hum)) gHum.value = hum;
        if (!isNaN(volt)) gVolt.value = volt;
      }).catch(err => console.error("API error:", err));
    }

    // Gọi ngay và lặp lại mỗi 5 giây
    updateGauges();
    setInterval(updateGauges, 5000);
  </script>
</body>
</html>
