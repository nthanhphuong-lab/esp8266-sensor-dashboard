<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Blynk ESP8266 Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-gauges@2.1.7/gauge.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background: #f4f4f4;
    }
    h2 { margin-bottom: 30px; }
    .gauges {
      display: flex;
      justify-content: center;
      gap: 50px;
    }
    canvas {
      width: 250px !important;
      height: 250px !important;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      padding: 10px;
    }
  </style>
</head>
<body>
  <h2>üì° D·ªØ li·ªáu t·ª´ ESP8266 qua Blynk</h2>

  <div class="gauges">
    <canvas id="gaugeTemp" data-type="radial-gauge"
      data-units="¬∞C" data-title="Nhi·ªát ƒë·ªô"
      data-min-value="0" data-max-value="60"
      data-major-ticks="0,10,20,30,40,50,60"
      data-minor-ticks="2"
      data-stroke-ticks="true"
      data-highlights='[{"from":40,"to":60,"color":"rgba(200,50,50,.75)"}]'
      data-color-plate="#fff"
      data-border-shadow-width="0"
      data-borders="false"
      data-needle-type="arrow"
      data-needle-width="2"
      data-animation-duration="500"
      data-animation-rule="linear"
      data-value="0">
    </canvas>

    <canvas id="gaugeHumi" data-type="radial-gauge"
      data-units="%" data-title="ƒê·ªô ·∫©m"
      data-min-value="0" data-max-value="100"
      data-major-ticks="0,20,40,60,80,100"
      data-minor-ticks="4"
      data-stroke-ticks="true"
      data-highlights='[{"from":80,"to":100,"color":"rgba(50,150,200,.75)"}]'
      data-color-plate="#fff"
      data-border-shadow-width="0"
      data-borders="false"
      data-needle-type="arrow"
      data-needle-width="2"
      data-animation-duration="500"
      data-animation-rule="linear"
      data-value="0">
    </canvas>

    <canvas id="gaugeVolt" data-type="radial-gauge"
      data-units="V" data-title="ƒêi·ªán √°p"
      data-min-value="0" data-max-value="20"
      data-major-ticks="0,5,10,15,20"
      data-minor-ticks="1"
      data-stroke-ticks="true"
      data-highlights='[{"from":15,"to":20,"color":"rgba(200,200,50,.75)"}]'
      data-color-plate="#fff"
      data-border-shadow-width="0"
      data-borders="false"
      data-needle-type="arrow"
      data-needle-width="2"
      data-animation-duration="500"
      data-animation-rule="linear"
      data-value="0">
    </canvas>
  </div>

  <script>
    const token = "djlxGXmIjuPjubwUqdVCMgB76av9UhNI";

    async function getData() {
      try {
        const temp = await fetch(`https://blynk.cloud/external/api/get?token=${token}&v1`).then(r=>r.text());
        const humi = await fetch(`https://blynk.cloud/external/api/get?token=${token}&v2`).then(r=>r.text());
        const volt = await fetch(`https://blynk.cloud/external/api/get?token=${token}&v3`).then(r=>r.text());

        document.gauges.forEach(g => {
          if (g.canvas.element.id === "gaugeTemp") g.value = parseFloat(temp) || 0;
          if (g.canvas.element.id === "gaugeHumi") g.value = parseFloat(humi) || 0;
          if (g.canvas.element.id === "gaugeVolt") g.value = parseFloat(volt) || 0;
        });

      } catch (e) {
        console.error("L·ªói khi g·ªçi API Blynk:", e);
      }
    }

    // load khi m·ªü trang
    getData();
    // c·∫≠p nh·∫≠t m·ªói 5 gi√¢y
    setInterval(getData, 5000);
  </script>
</body>
</html>
